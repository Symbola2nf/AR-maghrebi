<!DOCTYPE html>
<html>
<head>
    <title>E-asycomme AR Без Маркера</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-ar-session/dist/aframe-ar-session.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <div id="loader" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #1a1a1a; z-index: 10; display: flex; align-items: center; justify-content: center; color: white; font-family: 'Oxanium', sans-serif; font-size: 1.5rem;">
        جارٍ تهيئة الواقع المعزز...
    </div>

    <a-scene 
        ar-session="sessionType: immersive-ar; requiredFeatures: hit-test;"
        renderer="logarithmicDepthBuffer: true;"
        vr-mode-ui="enabled: false">
        
        <a-assets>
            <a-asset-item 
                id="pizza-model" 
                src="Pizza slice.glb" 
                response-type="arraybuffer" 
                crossorigin="anonymous">
            </a-asset-item>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false" rotation-controls="enabled: false"></a-camera>

        <a-gltf-model 
            id="placed-pizza"
            gltf-model="#pizza-model"
            visible="false"
            scale="0.2 0.2 0.2"
            position="0 -0.5 -1"
            rotation="0 0 0">
        </a-gltf-model>

    </a-scene>

    <script>
        const scene = document.querySelector('a-scene');
        const loader = document.getElementById('loader');
        const placedPizza = document.getElementById('placed-pizza');

        // إخفاء شاشة التحميل عند تهيئة المشهد
        scene.addEventListener('ar-session-ready', function () {
            loader.style.display = 'none';
        });

        // عند النقر على الشاشة، ضع المجسم في المكان الذي تم النقر عليه
        scene.addEventListener('ar-hit-test-start', function () {
            // يمكن إضافة شاشة انتظار هنا إذا أردت
        });

        scene.addEventListener('ar-hit-test-update', function (event) {
            if (event.detail.hit && !placedPizza.getAttribute('visible')) {
                // يمكنك إظهار مؤشر للمكان قبل وضع المجسم
            }
        });
        
        scene.addEventListener('ar-hit-test-result', function (event) {
            if (event.detail.hit) {
                const hit = event.detail.hit;
                placedPizza.setAttribute('position', hit.position);
                placedPizza.setAttribute('visible', true);
            }
        });

        // عند النقر في أي مكان في المشهد، ضع البيتزا
        scene.addEventListener('click', function (event) {
            if (!placedPizza.getAttribute('visible')) {
                // إذا لم يتم وضع المجسم بعد، فسيتم وضعه عند النقر
                // ar-hit-test-result listener سيتكفل بالوضع
            }
        });
        
        // إظهار شاشة التحميل إذا استغرق تحميل المجسم وقتاً طويلاً
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (loader.style.display !== 'none') {
                    loader.textContent = 'الرجاء التأكد من وجود إضاءة جيدة والمشي قليلاً';
                }
            }, 10000); // إظهار رسالة بعد 10 ثوانٍ إذا لم يتم التحميل
        });
    </script>
</body>
</html>
